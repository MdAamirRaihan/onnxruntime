#!/bin/bash 

agentName=$1
finalCharacter=${agentName: -1}
echo "agent name $agentName"
echo "agent name final character : $finalCharacter"
targetRender=$((finalCharacter+128))

echo -e "\n=========================================================================="
echo "================================ rocm-smi ================================"
echo "=========================================================================="
rocm-smi

echo -e "\n====================================================================================="
echo "================================ rocm-smi --showpids ================================"
echo "====================================================================================="
rocm-smi --showpids

echo -e "\n====================================================================================="
echo "================================ rocm-smi --showpids gpus ================================"
echo "====================================================================================="
rocm-smi --showpidgpus 

echo -e "\n================================================================================="
echo "================================ show all renders ================================"
echo "================================================================================="
lsof /dev/dri/renderD*

echo -e "\n======================================================================================"
echo "================================ show specific render ================================"
echo "======================================================================================"
lsof /dev/dri/renderD${targetRender}

echo -e "\n=============================================================================================="
echo "================================ show specific render pids detail ================================"
echo "=============================================================================================="
lsof /dev/dri/renderD${targetRender} | grep "mem" | awk '{print $2}' | xargs -I {} ps {}